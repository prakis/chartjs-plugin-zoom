/*!
 * @license
 * chartjs-plugin-zoom
 * http://chartjs.org/
 * Version: 0.7.0
 *
 * Copyright 2019 Chart.js Contributors
 * Released under the MIT license
 * https://github.com/chartjs/chartjs-plugin-zoom/blob/master/LICENSE.md
 */
!function(o,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("chart.js"),require("hammerjs")):"function"==typeof define&&define.amd?define(["chart.js","hammerjs"],e):(o=o||self).ChartZoom=e(o.Chart,o.Hammer)}(this,function(o,e){"use strict";o=o&&o.hasOwnProperty("default")?o.default:o,e=e&&e.hasOwnProperty("default")?e.default:e;var t=o.helpers,n=o.Zoom=o.Zoom||{},i=n.zoomFunctions=n.zoomFunctions||{},a=n.panFunctions=n.panFunctions||{};function m(o,e){var n={};void 0!==o.options.pan&&(n.pan=o.options.pan),void 0!==o.options.pan&&(n.zoom=o.options.zoom),o.$zoom._options=t.merge({},[e,n])}function l(o){var e=o.$zoom._originalOptions;t.each(o.scales,function(o){e[o.id]||(e[o.id]=t.clone(o.options))}),t.each(e,function(t,n){o.scales[n]||delete e[n]})}function r(o,e){return void 0===o||"string"==typeof o&&-1!==o.indexOf(e)}function s(o,e){if(o.scaleAxes&&o.rangeMax&&!t.isNullOrUndef(o.rangeMax[o.scaleAxes])){var n=o.rangeMax[o.scaleAxes];e>n&&(e=n)}return e}function c(o,e){if(o.scaleAxes&&o.rangeMin&&!t.isNullOrUndef(o.rangeMin[o.scaleAxes])){var n=o.rangeMin[o.scaleAxes];e<n&&(e=n)}return e}function u(o,e,t,n){var i=o.max-o.min,a=i*(e-1),m=o.isHorizontal()?t.x:t.y,l=(o.getValueForPixel(m)-o.min)/i,r=a*l,u=a*(1-l);o.options.ticks.min=c(n,o.min+r),o.options.ticks.max=s(n,o.max-u)}function d(o,e,t,n){var a=i[o.options.type];a&&a(o,e,t,n)}function p(o,e,n,i,a,m,s,c){var u=o.chartArea;i||(i={x:(u.left+u.right)/2,y:(u.top+u.bottom)/2});var p=o.$zoom._options.zoom;if(p.enabled){l(o);var f,v=p.mode;f="xy"===v&&void 0!==a?a:"xy",t.each(o.scales,function(o){o.isHorizontal()&&r(v,"x")&&r(f,"x")?(p.scaleAxes="x",d(o,e,i,p)):!o.isHorizontal()&&r(v,"y")&&r(f,"y")&&(p.scaleAxes="y",d(o,n,i,p))}),o.update(0),"function"==typeof p.onZoom&&p.onZoom({chart:o},m,s,c)}}function f(o,e,n){var i,a=o.options.ticks,m=o.min,l=o.max,r=o.getValueForPixel(o.getPixelForValue(m)-e),s=o.getValueForPixel(o.getPixelForValue(l)-e),c=r,u=s;n.scaleAxes&&n.rangeMin&&!t.isNullOrUndef(n.rangeMin[n.scaleAxes])&&(c=n.rangeMin[n.scaleAxes]),n.scaleAxes&&n.rangeMax&&!t.isNullOrUndef(n.rangeMax[n.scaleAxes])&&(u=n.rangeMax[n.scaleAxes]),r>=c&&s<=u?(a.min=r,a.max=s):r<c?(i=m-c,a.min=c,a.max=l-i):s>u&&(i=u-l,a.max=u,a.min=m+i)}function v(o,e,t){var n=a[o.options.type];n&&n(o,e,t)}function z(o){for(var e=o.scales,t=Object.keys(e),n=0;n<t.length;n++){var i=e[t[n]];if(i.isHorizontal())return i}}function h(o){for(var e=o.scales,t=Object.keys(e),n=0;n<t.length;n++){var i=e[t[n]];if(!i.isHorizontal())return i}}o.Zoom.defaults=o.defaults.global.plugins.zoom={pan:{enabled:!1,mode:"xy",speed:20,threshold:10},zoom:{enabled:!1,mode:"xy",sensitivity:3,speed:.1}},n.zoomFunctions.category=function(o,e,t,i){var a=o.chart.data.labels,m=o.minIndex,l=a.length-1,r=o.maxIndex,u=i.sensitivity,d=o.isHorizontal()?o.left+o.width/2:o.top+o.height/2,p=o.isHorizontal()?t.x:t.y;n.zoomCumulativeDelta=e>1?n.zoomCumulativeDelta+1:n.zoomCumulativeDelta-1,Math.abs(n.zoomCumulativeDelta)>u&&(n.zoomCumulativeDelta<0?(p>=d?m<=0?r=Math.min(l,r+1):m=Math.max(0,m-1):p<d&&(r>=l?m=Math.max(0,m-1):r=Math.min(l,r+1)),n.zoomCumulativeDelta=0):n.zoomCumulativeDelta>0&&(p>=d?m=m<r?m=Math.min(r,m+1):m:p<d&&(r=r>m?r=Math.max(m,r-1):r),n.zoomCumulativeDelta=0),o.options.ticks.min=c(i,a[m]),o.options.ticks.max=s(i,a[r]))},n.zoomFunctions.time=function(o,e,t,n){u(o,e,t,n),o.options.time.min=o.options.ticks.min,o.options.time.max=o.options.ticks.max},n.zoomFunctions.linear=u,n.zoomFunctions.logarithmic=u,n.panFunctions.category=function(o,e,t){var i,a=o.chart.data.labels,m=a.length-1,l=Math.max(o.ticks.length,1),r=t.speed,u=o.minIndex,d=Math.round(o.width/(l*r));n.panCumulativeDelta+=e,u=n.panCumulativeDelta>d?Math.max(0,u-1):n.panCumulativeDelta<-d?Math.min(m-l+1,u+1):u,n.panCumulativeDelta=u!==o.minIndex?0:n.panCumulativeDelta,i=Math.min(m,u+l-1),o.options.ticks.min=c(t,a[u]),o.options.ticks.max=s(t,a[i])},n.panFunctions.time=function(o,e,t){f(o,e,t);var n=o.options;n.time.min=n.ticks.min,n.time.max=n.ticks.max},n.panFunctions.linear=f,n.panFunctions.logarithmic=f,n.panCumulativeDelta=0,n.zoomCumulativeDelta=0;var x={id:"zoom",afterInit:function(o){o.resetZoom=function(){l(o);var e=o.$zoom._originalOptions;t.each(o.scales,function(o){var t=o.options.time,n=o.options.ticks;e[o.id]?(t&&(t.min=e[o.id].time.min,t.max=e[o.id].time.max),n&&(n.min=e[o.id].ticks.min,n.max=e[o.id].ticks.max)):(t&&(delete t.min,delete t.max),n&&(delete n.min,delete n.max))}),o.update()}},beforeUpdate:function(o,e){m(o,e)},beforeInit:function(o,i){o.$zoom={_originalOptions:{}},m(o,i);var a=o.$zoom._node=o.chart.ctx.canvas,s=o.$zoom._options,c=s.pan&&s.pan.threshold;if(o.$zoom._mouseDownHandler=function(e){o.$zoom._options.zoom&&o.$zoom._options.zoom.drag&&(a.addEventListener("mousemove",o.$zoom._mouseMoveHandler),o.$zoom._dragZoomStart=e)},a.addEventListener("mousedown",o.$zoom._mouseDownHandler),o.$zoom._mouseMoveHandler=function(e){o.$zoom._options.zoom&&o.$zoom._options.zoom.drag&&o.$zoom._dragZoomStart&&(o.$zoom._dragZoomEnd=e,o.update(0))},o.$zoom._mouseUpHandler=function(e){if(o.$zoom._options.zoom&&o.$zoom._options.zoom.drag&&o.$zoom._dragZoomStart){a.removeEventListener("mousemove",o.$zoom._mouseMoveHandler);var t=o.chartArea,n=z(o),i=h(o),m=o.$zoom._dragZoomStart,l=n.left,s=n.right,c=i.top,u=i.bottom;if(r(o.$zoom._options.zoom.mode,"x")){var d=m.target.getBoundingClientRect().left;l=Math.min(m.clientX,e.clientX)-d,s=Math.max(m.clientX,e.clientX)-d}if(r(o.$zoom._options.zoom.mode,"y")){var f=m.target.getBoundingClientRect().top;c=Math.min(m.clientY,e.clientY)-f,u=Math.max(m.clientY,e.clientY)-f}var v=s-l,x=t.right-t.left,g=1+(x-v)/x,$=u-c,_=t.bottom-t.top,y=1+(_-$)/_;if(o.$zoom._dragZoomStart=null,o.$zoom._dragZoomEnd=null,v>0||$>0){var M={x:m.clientX-n.left,y:m.clientY-i.top},C={x:e.clientX-n.left,y:e.clientY-i.top},b={left:n.left,top:i.top};p(o,g,y,{x:(l-t.left)/(1-v/x)+t.left,y:(c-t.top)/(1-$/_)+t.top},null,M,C,b)}}},a.ownerDocument.addEventListener("mouseup",o.$zoom._mouseUpHandler),o.$zoom._wheelHandler=function(e){if(!o.$zoom._options.zoom||!o.$zoom._options.zoom.drag){var t=e.target.getBoundingClientRect(),n={x:e.clientX-t.left,y:e.clientY-t.top},i=o.$zoom._options.zoom.speed;e.deltaY>=0&&(i=-i);var a={x:e.clientX,y:e.clientY},m={x:e.clientX+t.width,y:e.clientX+t.height};p(o,1+i,1+i,n,null,a,m,{left:0,top:0}),e.preventDefault()}},a.addEventListener("wheel",o.$zoom._wheelHandler),e){var u,d=new e.Manager(a);d.add(new e.Pinch),d.add(new e.Pan({threshold:c}));var f=function(e){var t,n=1/u*e.scale,i=e.target.getBoundingClientRect(),a={x:e.center.x-i.left,y:e.center.y-i.top},m=Math.abs(e.pointers[0].clientX-e.pointers[1].clientX),l=Math.abs(e.pointers[0].clientY-e.pointers[1].clientY),r=m/l;t=r>.3&&r<1.7?"xy":m>l?"x":"y";var s={x:e.pointers[0].clientX,y:e.pointers[0].clientY},c={x:e.pointers[1].clientX,y:e.pointers[1].clientY};p(o,n,n,a,t,s,c,{left:0,top:0}),u=e.scale};d.on("pinchstart",function(){u=1}),d.on("pinch",f),d.on("pinchend",function(o){f(o),u=null,n.zoomCumulativeDelta=0});var x=null,g=null,$=!1,_=function(e){if(null!==x&&null!==g){$=!0;var n=e.deltaX-x,i=e.deltaY-g;x=e.deltaX,g=e.deltaY,function(o,e,n,i,a,m,s){l(o);var c=o.$zoom._options.pan;if(c.enabled){var u=c.mode;t.each(o.scales,function(o){o.isHorizontal()&&r(u,"x")&&0!==e?(c.scaleAxes="x",v(o,e,c)):!o.isHorizontal()&&r(u,"y")&&0!==n&&(c.scaleAxes="y",v(o,n,c))}),o.update(0),"function"==typeof c.onPan&&c.onPan({chart:o},e,n,i,a,m,s)}}(o,n,i,startX,endX,startY,endY)}};d.on("panstart",function(o){x=0,g=0,_(o)}),d.on("panmove",_),d.on("panend",function(){x=null,g=null,n.panCumulativeDelta=0,setTimeout(function(){$=!1},500)}),o.$zoom._ghostClickHandler=function(o){$&&o.cancelable&&(o.stopImmediatePropagation(),o.preventDefault())},a.addEventListener("click",o.$zoom._ghostClickHandler),o._mc=d}},beforeDatasetsDraw:function(o){var e=o.chart.ctx,t=o.chartArea;if(e.save(),e.beginPath(),o.$zoom._dragZoomEnd){var n=z(o),i=h(o),a=o.$zoom._dragZoomStart,m=o.$zoom._dragZoomEnd,l=n.left,s=n.right,c=i.top,u=i.bottom;if(r(o.$zoom._options.zoom.mode,"x")){var d=a.target.getBoundingClientRect().left;l=Math.min(a.clientX,m.clientX)-d,s=Math.max(a.clientX,m.clientX)-d}if(r(o.$zoom._options.zoom.mode,"y")){var p=a.target.getBoundingClientRect().top;c=Math.min(a.clientY,m.clientY)-p,u=Math.max(a.clientY,m.clientY)-p}var f=s-l,v=u-c,x=o.$zoom._options.zoom.drag;o.hideZoomRect||(e.fillStyle=x.backgroundColor||"rgba(225,225,225,0.3)",e.fillRect(l,c,f,v)),x.borderWidth>0&&(e.lineWidth=x.borderWidth,e.strokeStyle=x.borderColor||"rgba(225,225,225)",e.strokeRect(l,c,f,v))}e.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),e.clip()},afterDatasetsDraw:function(o){o.chart.ctx.restore()},destroy:function(o){if(o.$zoom){var t=o.$zoom._node;o.$zoom._options.zoom&&(t.removeEventListener("mousedown",o.$zoom._mouseDownHandler),t.removeEventListener("mousemove",o.$zoom._mouseMoveHandler),t.ownerDocument.removeEventListener("mouseup",o.$zoom._mouseUpHandler),t.removeEventListener("wheel",o.$zoom._wheelHandler)),e&&t.removeEventListener("click",o.$zoom._ghostClickHandler),delete o.$zoom;var n=o._mc;n&&(n.remove("pinchstart"),n.remove("pinch"),n.remove("pinchend"),n.remove("panstart"),n.remove("pan"),n.remove("panend"))}}};return o.plugins.register(x),x});
